{{/* Inject KaTeX globally when math is enabled at site or page level */}}
{{- $enableMath := or (default false .Site.Params.BookMath) (default false .Params.math) -}}
{{- if and $enableMath (not (.Page.Store.Get "katex")) -}}
  <link rel="stylesheet" href="{{ "katex/katex.min.css" | relURL }}" />
  <script defer src="{{ "katex/katex.min.js" | relURL }}"></script>
  {{ with resources.Get "katex.json" }}
    <script defer src="{{ "katex/auto-render.min.js" | relURL }}" onload="renderMathInElement(document.body, {{ .Content | safeJS }});"></script>
  {{ end }}
  {{- .Page.Store.Set "katex" true -}}
{{- end -}}
